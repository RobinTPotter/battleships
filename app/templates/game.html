{% extends "layout.html" %}

{% block moremeta %}
<meta http-equiv="cache-control" content="max-age=0">
<meta http-equiv="cache-control" content="no-cache">
{% endblock %}


{% block content %}

<style>

table {  border-collapse: collapse }
td, tr { border: none; }
div.boat { border: 1px black solid; }
td  { width:20px; height:20px; }
.water { background-color: cyan }
.miss { background-color: yellow }
.hit { background-color: red }
.boat { background-color: grey }

</style>
Stage: <span id="game_stage">{{ game.stage() }}</span>
<span id="whose_turn"></span>
<div id="myboard" style="display:inherit">
<h2>{{current_user.id}}</h2>
<span>
<table class="sea">
{% for row in game.show_board(current_user.id) %}
{% set r=loop.index - 1 -%}
<tr class="sea">
 {%- for col in row -%}
<td id="you_c{{loop.index - 1 }}r{{r}}" class="{{ col }} seablock sea"></td>
 {%- endfor -%}
</tr>
{%- endfor %}
</table>
</span>
{% if game.stage() == 'setup' %}
<span>
{% for boat in game.get_game_player(current_user.id).get_boats() %}
<div id="{{ boat.name ~ '|' ~ boat.length }}" class="dragboat draggable ui-widget-content ui-draggable boat" style="position: relative; width:{{ boat.length * 21 }}px; height:{{ 1 * 21 }}px">
</div>
{% endfor %}
</span>
{% endif %}
</div>

<div id="theirboard" style="display:none">
<h2 id="opponents_name">{{ game.opponent(current_user.id) }}</h2>
<table>
{% for row in game.show_opponent_view_board(current_user.id) %}
{% set r=loop.index -%}
<tr>
 {%- for col in row -%}
<td id="opp_c{{loop.index}}r{{r}}" class="{{ col }}"></td>
 {%- endfor -%}
</tr>
{%- endfor %}
</table>
</div>

<form>
<input type="button" value="swap" onclick="swap()"></input>
<input type="button" value="ping" onclick="ping()"></input>
<input type="button" value="ready" onclick="ready('{{ current_user.id }}','{{ game.id }}')"></input>
</form>


<script src="{{ url_for('static', filename='lib/socket-io/socket.io.min.js')}}"></script>
<script src="{{ url_for('static', filename='battleships.js')}}?{{ game.id }}"></script>
<script>


$(function() {
  $( ".dragboat" ).draggable({ "snap": ".sea", "containment": "table.sea" });
  //$( ".dragboat" ).doubletap(function() { alert('taptap')})
  $( ".dragboat" ).click(function(me) { 
    var length = Number(me.target.id.split('|')[1])
    var el = document.getElementById(me.target.id)
    var h = me.target.style.height
        console.log(h)
    if (h=='21px') {
        el.style.height = (length * 21)+'px'
        el.style.width =  (21)+'px'
        console.log(el)
    } else {
        el.style.height = (21)+'px'
        el.style.width =  (length * 21)+'px'
    
    }
    
    
    
  })
});


</script>
{% endblock %}

