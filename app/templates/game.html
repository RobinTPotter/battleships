{% extends "layout.html" %}

{% block moremeta %}
<meta http-equiv="cache-control" content="max-age=0">
<meta http-equiv="cache-control" content="no-cache">
{% endblock %}


{% block content %}

<style>

{# table {  border-collapse: collapse } #}
table {  border: none}
td, tr { border: none; }
div.boat { border: 1px black solid; }
td  { width:22px; height:22px; }
.water { background-color: cyan }
.miss { background-color: yellow }
.hit { background-color: red }
.boat { background-color: grey }

</style>
Stage: <span id="game_stage">{{ game.stage() }}</span>
<span id="whose_turn"></span>
<div id="myboard" style="display:inherit">
    <h2>{{current_user.id}}</h2>
    <div>
        <div id="sea">
            <table id="seabed"  class="sea">
                {% for row in game.show_board(current_user.id) %}
                {% set r=loop.index - 1 -%}
                    <tr class="sea">
                         {%- for col in row -%}
                        <td id="you_c{{loop.index - 1 }}r{{r}}" class="{{ col }} seablock sea"></td>
                         {%- endfor -%}
                    </tr>
                {%- endfor %}
            </table>
        </div>
        {% if game.stage() == 'setup' %}
        <div>
            {% for boat in game.get_game_player(current_user.id).get_boats() %}
            <div id="{{ boat.name ~ '|' ~ boat.length }}" class="dragboat boat" style="position: absolute; top: {{ 26 * loop.index }}; width:{{ boat.length * 22 + 4*(boat.length-1) }}px; height:{{ 1 * 22 }}px"></div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<div id="theirboard" style="display:none">
    <h2 id="opponents_name">{{ game.opponent(current_user.id) }}</h2>
    <table>
        {% for row in game.show_opponent_view_board(current_user.id) %}
        {% set r=loop.index -%}
        <tr>
             {%- for col in row -%}
            <td id="opp_c{{loop.index}}r{{r}}" class="{{ col }}"></td>
             {%- endfor -%}
            </tr>
        {%- endfor %}
    </table>
</div>
<br />
<form>
<input type="button" value="swap" onclick="swap()"></input>
<input type="button" value="ping" onclick="ping()"></input>
<input type="button" value="ready" onclick="ready('{{ current_user.id }}','{{ game.id }}')"></input>
</form>
<div id="output">poo</div>


<script src="{{ url_for('static', filename='lib/socket-io/socket.io.min.js')}}"></script>
<script src="{{ url_for('static', filename='battleships.js')}}?{{ game.id }}"></script>
<script>

document.addEventListener('mousedown', function(e) { document.getElementById('output').innerHTML='md '+e; console.log(e) })
document.addEventListener('mousemove', function(e) { document.getElementById('output').innerHTML='mm '+e })
document.addEventListener('touchstart', function(e) { document.getElementById('output').innerHTML='ts '+e })
document.addEventListener('touchmove', function(e) { document.getElementById('output').innerHTML='tm '+e })
document.addEventListener('touchend', function(e) { document.getElementById('output').innerHTML='te '+e })

$(function() {
  $( ".dragboat" ).draggable(
    { "snap": ".seablock",
    "snapMode": "inner",
    "containment": "table.sea",
    "drag": function(event,ui) {
            var p = $('#seabed').position()
            console.log(Math.round((ui.offset.top - p.top - 2 )/26))
            console.log(Math.round((ui.offset.left - p.left - 2)/26))
        }
    }
   );
  
  //$( ".dragboat" ).doubletap(function() { alert('taptap')})
  $( ".boat" ).click(function(me) { 
    var length = Number(me.target.id.split('|')[1])
    var el = document.getElementById(me.target.id)
    var el = document.getElementById(me.target.id)
    var sea = document.getElementById('sea')
    var seatopnum = Number(sea.style.top.replace(/[^0-9]*/g,''))
    var sealeftnum = Number(sea.style.left.replace(/[^0-9]*/g,''))
    var seawidthnum = Number(sea.style.width.replace(/[^0-9]*/g,''))
    var seaheightnum = Number(sea.style.height.replace(/[^0-9]*/g,''))
    var h = me.target.style.height
    //console.log(h)
    var len = Number((length * 22) + 4*(length-1) )
    //console.log('length', length, 'len',len)
    if (h=='22px') {
        el.style.height = len +'px'
        el.style.width =  (22)+'px'
       
        
        
        
        var topnum = Number(el.style.top.replace(/[^0-9]*/g,''))
        var leftnum = Number(el.style.left.replace(/[^0-9]*/g,''))
       
        
        
    } else {
        el.style.height = (22)+'px'
        el.style.width =  len+'px'
        //console.log(el.style.top)
        //console.log(el.style.left)
        var topnum = Number(el.style.top.replace(/[^0-9]*/g,''))
        var leftnum = Number(el.style.left.replace(/[^0-9]*/g,''))
    }
    
  })
});


</script>
{% endblock %}

